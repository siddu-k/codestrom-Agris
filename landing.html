<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Galactic Horizon | Welcome</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <link rel="stylesheet" href="style.css">
    <style>
        /* CRITICAL FIX: Ensure full height so background renders */
        html,
        body {
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #000;
            /* Force Black */
            background: radial-gradient(circle at center, #0d1117 0%, #010409 100%);
        }

        #ui-layer {
            transition: opacity 2s ease-in-out;
            opacity: 0;
        }

        .visible {
            opacity: 1 !important;
        }

        .scifi-glow {
            text-shadow: 0 0 20px rgba(59, 130, 246, 0.6);
        }

        /* Full Screen Container */
        #canvas-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
    </style>
</head>

<body>

    <!-- Background Grid -->
    <div class="grid-overlay"></div>

    <!-- 3D Container -->
    <div id="canvas-container"></div>

    <!-- UI Overlay (Left Aligned) -->
    <div id="ui-layer" class="absolute inset-0 z-[10] flex items-center pl-10 md:pl-20 pointer-events-none">
        <div class="pointer-events-auto max-w-xl">
            <!-- Glass Card -->
            <div
                class="bg-black/40 backdrop-blur-xl border-l-4 border-blue-500 p-8 rounded-r-3xl border-y border-r border-white/5 relative overflow-hidden group">
                <div
                    class="absolute top-0 right-0 w-20 h-20 bg-blue-500/10 rounded-full blur-2xl -mr-10 -mt-10 transition-all group-hover:bg-blue-500/20">
                </div>

                <div class="flex items-center gap-3 mb-4">
                    <div class="h-px w-8 bg-blue-500"></div>
                    <span class="text-[10px] text-blue-400 font-mono tracking-[0.3em] uppercase">System Online</span>
                </div>

                <h1 class="text-7xl font-black text-white leading-[0.9] tracking-tighter mb-4 mix-blend-overlay">
                    GALACTIC<br>
                    <span
                        class="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-cyan-300 scifi-glow">HORIZON</span>
                </h1>

                <p class="text-slate-400 text-sm leading-relaxed mb-8 font-light border-l border-white/10 pl-4">
                    Advanced planetary telemetry and agricultural intelligence hub.
                    <br><span class="text-slate-500">Initializing orbital data stream...</span>
                </p>

                <div class="flex items-center gap-6">
                    <a href="index.html"
                        class="relative overflow-hidden group bg-blue-600 hover:bg-blue-500 text-white font-bold py-4 px-8 rounded-lg transition-all transform hover:scale-105 hover:shadow-[0_0_40px_rgba(37,99,235,0.4)]">
                        <div
                            class="absolute inset-0 bg-white/20 translate-y-full group-hover:translate-y-0 transition-transform duration-300 transform skew-y-12">
                        </div>
                        <span class="relative flex items-center gap-2 tracking-widest text-xs">
                            ENTER COMMAND
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                    d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
                            </svg>
                        </span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- MAIN JS LOGIC -->
    <script>
        let scene, camera, renderer, globe, clouds, stars, controls;
        let time = 0;

        const planetData = {
            earth: { tex: 'earth_atmos_2048.jpg', size: 5, atmos: true, color: 0x2f81f7 },
        };

        let introComplete = false;
        // FINAL POSITION: Centered Y=0, Zoomed In Z=20
        const targetPos = new THREE.Vector3(0, 0, 20);

        function init() {
            scene = new THREE.Scene();

            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 2000);

            const w = window.innerWidth;
            const h = window.innerHeight;

            // Apply Offset: Shift viewport so Earth appears on Right
            if (w > 768) {
                camera.setViewOffset(w, h, -(w * 0.25), 0, w, h);
            }

            // START POSITION: 
            // Y=0 to match targetPos.y=0. This prevents "moving up/down".
            // Z=400 starts far away.
            camera.position.set(0, 0, 400);

            // RENDERER FIX: Explicit alpha and black clear color
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setClearColor(0x000000, 0);
            renderer.setSize(w, h);
            // CLARITY: Use full device pixel ratio
            renderer.setPixelRatio(window.devicePixelRatio);
            document.getElementById('canvas-container').appendChild(renderer.domElement);

            // Controls
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.autoRotate = true;
            controls.autoRotateSpeed = 0.5;
            controls.enableZoom = false;
            controls.enablePan = false;

            // Lights - Brighter for clarity
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);

            const pointLight = new THREE.PointLight(0xffffff, 1.5);
            pointLight.position.set(20, 20, 20);
            scene.add(pointLight);

            createGlobe('earth');
            createStars();

            window.addEventListener('resize', onResize);
            animate();
        }

        function createGlobe(key) {
            const p = planetData[key];
            const geometry = new THREE.SphereGeometry(p.size, 128, 128);
            const loader = new THREE.TextureLoader();
            const texture = loader.load(`https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/planets/${p.tex}`);

            // CLARITY: Max Anisotropy
            texture.anisotropy = renderer.capabilities.getMaxAnisotropy();

            globe = new THREE.Mesh(geometry, new THREE.MeshPhongMaterial({
                map: texture,
                shininess: 15,
                specular: new THREE.Color(0x333333)
            }));
            scene.add(globe);

            if (p.atmos) {
                const cloudGeo = new THREE.SphereGeometry(p.size * 1.01, 128, 128);
                const cloudTex = loader.load('https://raw.githubusercontent.com/mrdoob/three.js/master/examples/textures/planets/earth_clouds_1024.png');
                clouds = new THREE.Mesh(cloudGeo, new THREE.MeshPhongMaterial({ map: cloudTex, transparent: true, opacity: 0.4 }));
                scene.add(clouds);
            }
        }

        function createStars() {
            const geo = new THREE.BufferGeometry();
            const pos = new Float32Array(5000 * 3);
            const sizes = new Float32Array(5000);

            for (let i = 0; i < 15000; i++) {
                pos[i] = (Math.random() - 0.5) * 1500;
                if (i % 3 === 0) sizes[i / 3] = Math.random();
            }

            geo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
            geo.setAttribute('size', new THREE.BufferAttribute(sizes, 1));

            const mat = new THREE.PointsMaterial({
                size: 1,
                color: 0xffffff,
                transparent: true,
                opacity: 0.8
            });

            stars = new THREE.Points(geo, mat);
            scene.add(stars);
        }

        function onResize() {
            const w = window.innerWidth;
            const h = window.innerHeight;

            // Re-apply offsets on resize
            camera.aspect = w / h;
            camera.clearViewOffset();
            if (w > 768) {
                camera.setViewOffset(w, h, -(w * 0.25), 0, w, h);
            }

            camera.updateProjectionMatrix();
            renderer.setSize(w, h);
        }

        function animate() {
            requestAnimationFrame(animate);
            time += 0.005;

            // Rotation
            if (clouds) clouds.rotation.y += 0.0003;
            if (globe) globe.rotation.y += 0.0001;

            if (!introComplete) {
                // Smooth Intro Zoom
                camera.position.lerp(targetPos, 0.03);

                // When close enough, snap and switch to orbit
                if (camera.position.distanceTo(targetPos) < 0.5) {
                    introComplete = true;
                    camera.position.copy(targetPos);
                    document.getElementById('ui-layer').classList.add('visible');
                }
            } else {
                controls.update();
            }

            renderer.render(scene, camera);
        }

        window.onload = init;
    </script>
</body>

</html>
